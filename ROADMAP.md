# Pactwork Roadmap

> Transforming from MSW handler generator to **the agentic API simulation platform**.

---

## Vision

Pactwork enables AI agents to keep API mocks perfectly in sync with OpenAPI specs. But generating handlers is just the foundation. The full vision is **bulletproof functional prototypes** â€” where every error state, loading state, and edge case is simulated before integration.

**The goal:** Agents don't interpret APIs. They enforce contracts and simulate every scenario.

---

## Phases

### Phase 1: Foundation âœ… COMPLETE

**Status:** Released in v1.0.0

| Feature | Command | Description |
|---------|---------|-------------|
| Handler generation | `pactwork generate` | Generate MSW handlers from OpenAPI spec |
| Drift detection | `pactwork validate` | Detect when handlers don't match spec |
| Breaking changes | `pactwork breaking` | Compare two spec versions for breaking changes |
| Contract testing | `pactwork record/verify` | Record and verify API contracts |
| TypeScript types | `pactwork types` | Generate TypeScript types from spec |
| CI integration | GitHub Action | `adrozdenko/pactwork@v1` |

**Value:** Agents can keep mocks in sync with one loop: `validate â†’ generate â†’ commit`

---

### Phase 2: Scenario Catalog âœ… COMPLETE

**Status:** Released in v1.1.0

**Objective:** Generate a scenario catalog from OpenAPI spec â€” not just success handlers, but every response code defined in the spec.

#### What gets generated

```typescript
// scenarios.ts - Generated by Pactwork
export const scenarios = {
  getUser: {
    success: { status: 200 },
    notFound: { status: 404 },
    unauthorized: { status: 401 },
    serverError: { status: 500 },
  },
  listUsers: {
    success: { status: 200 },
    empty: { status: 200, body: [] },
    forbidden: { status: 403 },
  },
  createUser: {
    created: { status: 201 },
    badRequest: { status: 400 },
    conflict: { status: 409 },
  }
} as const
```

#### Key decisions

| Decision | Rationale |
|----------|-----------|
| Scenarios as data, not code | Avoids combinatorial explosion in generated files |
| Scoped by `operationId` | Stable identifiers from spec, not path strings |
| Derived from spec responses | Every documented response code becomes a scenario |
| Type-safe catalog | Full TypeScript inference for scenario names |

#### Commands

```bash
# Generate handlers + scenario catalog
pactwork generate --with-scenarios

# List available scenarios
pactwork scenarios --list

# Validate scenario coverage
pactwork scenarios --coverage
```

---

### Phase 3: Runtime Utilities âœ… COMPLETE

**Status:** Released in v1.1.0

**Objective:** Provide composable utilities to apply scenarios at runtime â€” in tests, Storybook, or development.

#### API Design

```typescript
import { handlers, handlerMeta, scenarios } from './mocks'
import { applyScenario, withLatency, withSequence, pipe } from 'pactwork/runtime'

// Apply a specific scenario
const errorHandlers = applyScenario(handlers, handlerMeta, 'getUser', scenarios.getUser.notFound)

// Add latency simulation
const slowHandlers = withLatency(handlers, handlerMeta, 2000)

// Simulate flaky API (fail twice, then succeed)
const flakyHandlers = withSequence(handlers, handlerMeta, 'getUser', [500, 500, 200])

// Combine utilities
const testHandlers = pipe(
  handlers,
  h => applyScenario(h, scenarios.getUser.notFound),
  h => withLatency(h, 1000)
)
```

#### Utilities planned

| Utility | Purpose |
|---------|---------|
| `applyScenario(handlers, scenario)` | Replace handler response with scenario |
| `withLatency(handlers, ms)` | Add delay to all responses |
| `withLatency(handlers, operationId, ms)` | Add delay to specific operation |
| `withSequence(handlers, operationId, statuses)` | Return different statuses in sequence |
| `withRateLimit(handlers, operationId, opts)` | Simulate rate limiting |
| `withNetworkError(handlers, operationId)` | Simulate network failures |
| `withSeed(handlers, seed)` | Deterministic data generation |

#### Key decisions

| Decision | Rationale |
|----------|-----------|
| Pure functions, no mutation | Composable, testable, predictable |
| Operation-scoped by default | Granular control without path string matching |
| Deterministic option | Reproducible tests and Chromatic snapshots |

---

### Phase 4: Storybook Integration ðŸ”® FUTURE

**Status:** Concept

**Objective:** First-class Storybook addon for scenario selection â€” toggle error states, latency, and edge cases from the Storybook UI.

#### Story API

```typescript
// Button.stories.tsx
export const Loading: Story = {
  parameters: {
    pactwork: {
      scenario: 'getUser.loading',
      latency: 2000
    }
  }
}

export const Error: Story = {
  parameters: {
    pactwork: { scenario: 'getUser.serverError' }
  }
}

export const Empty: Story = {
  parameters: {
    pactwork: { scenario: 'listUsers.empty' }
  }
}
```

#### Addon features

- **Scenario dropdown** â€” Select any scenario for current story
- **Latency slider** â€” Adjust response delay in real-time
- **Network panel** â€” See which handlers are active
- **Coverage badge** â€” Show which scenarios have stories

---

## Architecture Decisions

### OpenAPI Spec as Source of Truth

The spec is the neutral contract between frontend and backend. Neither "leads" â€” both conform to the spec.

```text
OpenAPI Spec (contract)
       â†“
Pactwork (generates handlers + scenarios)
       â†“
Frontend (consumes)    Backend (implements)
```

### Scenario Catalog as Data

Instead of generating separate handler files for each scenario (code explosion), we generate a single data structure that runtime utilities interpret.

**Why:**
- Smaller generated output
- Easy to enumerate for agents
- Flexible runtime application
- No regeneration needed to change scenarios

### Runtime vs Generation-time Simulation

Simulation (latency, sequences, network errors) is applied at **runtime**, not **generation-time**.

**Why:**
- Stories control their own scenarios
- No regeneration when changing simulation
- Same handlers, different behaviors per test

---

## Non-Goals

Things Pactwork intentionally does NOT do:

| Non-goal | Reason |
|----------|--------|
| Replace MSW | We build on MSW, not replace it |
| Full API server | Pactwork is for mocking, not serving |
| Backend code generation | Focus is frontend/testing mocks |
| GraphQL support | OpenAPI/REST focus (GraphQL may come later) |

---

## Contributing

Want to help build the future phases? See [CONTRIBUTING.md](CONTRIBUTING.md).

Priority areas:
- Phase 3: Runtime utility design
- Phase 4: Storybook addon

---

## Timeline

| Phase | Target | Status |
|-------|--------|--------|
| Phase 1 | Q1 2025 | âœ… Complete |
| Phase 2 | Q1 2025 | âœ… Complete |
| Phase 3 | Q1 2026 | âœ… Complete |
| Phase 4 | Q2 2026 | ðŸ”œ Next |

*Timelines are estimates. We ship when it's ready.*
